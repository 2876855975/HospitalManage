$(function(){var c=null;var b=null;var e = null;$("#qrLog").on("click",function(){if(null!=e){e.close();}$("#model").fadeIn(100);d()});function d(){$.ajax({type:"post",url:"/qr.json",dataType:"json",success:function(e){$("#imgCode").attr("src","/qc/"+e.Validateuuid+".jpg");c=e.uuid;b=e.Validateuuid;a()},error:function(e){alert("服务器异常！")}})}$("#model").on("click",function(){$(this).fadeOut(200)});$("#model > div").on("click",function(e){e.stopPropagation()});function a(){var f=null;e=new WebSocket("ws://"+window.location.host+"/socket/"+c);if(typeof(WebSocket)=="undefined"){console.log("您的浏览器不支持WebSocket")}else{e.onopen=function(){e.send('{"Validateuuid":"'+b+'"}')};e.onmessage=function(g){console.log(g.data);var h=JSON.parse(g.data);if(h.successful=="Successful"){setTimeout(function(){clearTimeout(f);$("#model > div > div:eq(0)").hide();$("#model > div > div:eq(1)").fadeOut(100);$("#model > div > div:eq(2)").fadeIn(200);setTimeout(function(){$.ajax({type:"post",url:"/SessionJump/"+h.validateUuid+"/"+h.dNumber,dataType:"text",success:function(i){if(i=="True"){setTimeout(function(){window.location.href="/doLogin"},1000)}else{alert("服务器发生错误！")}},error:function(i){alert("服务器发生错误！")}});$("#model").fadeOut(200)},5000)},1000)}if(h.successful=="Faillog"){clearTimeout(f);$("#model > div > div:eq(0)").hide();$("#model > div > div:eq(1)").hide();$("#model > div > div:eq(2)").hide();$("#model > div > div:eq(3)").fadeOut(100);$("#model > div > div:eq(4)").fadeIn(200);setTimeout(function(){d();$("#model > div > div:eq(0)").fadeIn(200);$("#model > div > div:eq(1)").hide();$("#model > div > div:eq(2)").hide();$("#model > div > div:eq(3)").hide();$("#model > div > div:eq(4)").fadeOut(100)},10000)}if(h.successful=="Fail"){clearTimeout(f);$("#model > div > div:eq(0)").hide();$("#model > div > div:eq(1)").hide();$("#model > div > div:eq(2)").fadeOut(100);$("#model > div > div:eq(3)").fadeIn(200);$("#model > div > div:eq(4)").hide();setTimeout(function(){d();$("#model > div > div:eq(0)").fadeIn(200);$("#model > div > div:eq(1)").hide();$("#model > div > div:eq(2)").hide();$("#model > div > div:eq(3)").fadeOut(100);$("#model > div > div:eq(4)").hide()},10000)}if(h.successful=="Loading"){$("#model > div > div:eq(0)").fadeOut(100);$("#model > div > div:eq(1)").fadeIn(200);f=setTimeout(function(){$("#model > div > div:eq(0)").hide();$("#model > div > div:eq(1)").hide();$("#model > div > div:eq(2)").fadeOut(100);$("#model > div > div:eq(3)").fadeIn(200)},60000)}};$(window).unload(function(){e.close()})}}});