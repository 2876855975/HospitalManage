$(function(){var c=null;var b=null;$("#qrLog").on("click",function(){$("#model").fadeIn(100);d()});$("#delQR").on("click",function(){if(confirm("确定要禁用快捷登录吗？")){$.ajax({type:"post",url:"/sdQrUser.json",dataType:"json",success:function(e){if(e.status=="True"){alert("禁用成功！");location.href="/getByDoctor"}else{alert("禁用失败！")}},error:function(e){alert("服务器异常！")}})}});function d(){$.ajax({type:"post",url:"/qr.json",dataType:"json",success:function(e){$("#imgCode").attr("src","/qr/"+e.Validateuuid+".jpg");c=e.uuid;b=e.Validateuuid;a()},error:function(e){alert("服务器异常！")}})}$("#model").on("click",function(){$(this).fadeOut(200)});$("#model > div").on("click",function(e){e.stopPropagation()});function a(){var f=null;var e=new WebSocket("ws://"+window.location.host+"/socket/"+c);if(typeof(WebSocket)=="undefined"){console.log("您的浏览器不支持WebSocket")}else{e.onopen=function(){e.send('{"Validateuuid":"'+b+'"}')};e.onmessage=function(g){console.log(g.data);var h=JSON.parse(g.data);if(h.successful=="Successful"){setTimeout(function(){clearTimeout(f);$("#model > div > div:eq(0)").hide();$("#model > div > div:eq(3)").hide();$("#model > div > div:eq(1)").fadeOut(100);$("#model > div > div:eq(2)").fadeIn(200);setTimeout(function(){setTimeout(function(){location.href="/getByDoctor"},1000);$("#model").fadeOut(200)},5000)},1000)}if(h.successful=="Fail"){clearTimeout(f);$("#model > div > div:eq(0)").hide();$("#model > div > div:eq(1)").hide();$("#model > div > div:eq(2)").fadeOut(100);$("#model > div > div:eq(3)").fadeIn(200);setTimeout(function(){d();$("#model > div > div:eq(0)").fadeIn(200);$("#model > div > div:eq(1)").hide();$("#model > div > div:eq(2)").hide();$("#model > div > div:eq(3)").fadeOut(100)},10000)}if(h.successful=="Stop"){clearTimeout(f);$("#model > div > div:eq(0)").hide();$("#model > div > div:eq(1)").hide();$("#model > div > div:eq(2)").hide();$("#model > div > div:eq(3)").fadeOut(100);$("#model > div > div:eq(4)").fadeIn(200);setTimeout(function(){d();$("#model > div > div:eq(0)").fadeIn(200);$("#model > div > div:eq(1)").hide();$("#model > div > div:eq(2)").hide();$("#model > div > div:eq(3)").hide();$("#model > div > div:eq(4)").fadeOut(100)},10000)}if(h.successful=="Loading"){$("#model > div > div:eq(2)").hide();$("#model > div > div:eq(3)").hide();$("#model > div > div:eq(0)").fadeOut(100);$("#model > div > div:eq(1)").fadeIn(200);$.ajax({type:"post",url:"/valiEmail.json",dataType:"json"});f=setTimeout(function(){$("#model > div > div:eq(0)").hide();$("#model > div > div:eq(1)").hide();$("#model > div > div:eq(2)").fadeOut(100);$("#model > div > div:eq(3)").fadeIn(200)},60000)}};$(window).unload(function(){e.close()})}}});